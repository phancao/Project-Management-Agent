2025-11-03 12:38:35,971 - __main__ - INFO - Starting DeerFlow API server on localhost:8000
2025-11-03 12:38:35,971 - __main__ - INFO - Log level: INFO
2025-11-03 12:38:37,414 - src.graph.checkpoint - WARNING - Checkpoint saver is disabled
2025-11-03 12:38:37,441 - src.server.app - INFO - Allowed origins: ['http://localhost:3000']
INFO:     Started server process [69181]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://localhost:8000 (Press CTRL+C to quit)
2025-11-03 12:38:41,301 - src.conversation.flow_manager - INFO - LLM-based intent classifier initialized
2025-11-03 12:38:41,301 - src.conversation.flow_manager - INFO - LLM-based data extractor initialized
2025-11-03 12:38:41,374 - src.conversation.flow_manager - INFO - PM Provider initialized: OpenProjectProvider
2025-11-03 12:38:41,375 - src.conversation.flow_manager - INFO - Self-learning system initialized
2025-11-03 12:38:41,375 - src.server.app - INFO - Created global ConversationFlowManager singleton
INFO:     ::1:52630 - "POST /api/pm/chat/stream HTTP/1.1" 200 OK
2025-11-03 12:38:41,377 - src.server.app - INFO - [PM-CHAT-TIMING] generate_stream started
2025-11-03 12:38:41,377 - src.conversation.flow_manager - INFO - [TIMING] generate_pm_plan started
2025-11-03 12:38:45,962 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-03 12:38:45,973 - src.conversation.flow_manager - INFO - [TIMING] LLM invoke completed: 4.59s
2025-11-03 12:38:45,973 - src.conversation.flow_manager - INFO - PM plan LLM response: {
  "locale": "vi-VN",
  "overall_thought": "Tôi sẽ tiến hành xóa ETA của tất cả các task được giao cho bạn.",
  "steps": [
    {
      "step_type": "list_my_tasks",
      "title": "Liệt kê Tasks Được Assign",
      "description": "Liệt kê tất cả task được giao cho bạn để xác định những task nào có ETA cần xóa.",
      "requires_context": false
    },
    {
      "step_type": "update_task",
      "title": "Xóa ETA cho Task",
      "description": "Cập nhật và xóa ETA cho từng task đã được liệt kê trước đó.",
      "requires_context": true
    }
  ]
}
2025-11-03 12:38:45,973 - src.conversation.flow_manager - INFO - Generated PM plan with 2 steps in 4.60s
2025-11-03 12:38:45,973 - src.server.app - INFO - [PM-CHAT-TIMING] PM plan generated: 4.60s
2025-11-03 12:38:45,973 - src.server.app - INFO - [PM-CHAT-TIMING] Needs research: False - 4.60s
2025-11-03 12:38:45,973 - src.server.app - INFO - [PM-CHAT-TIMING] process_task started: 4.60s
2025-11-03 12:38:45,973 - src.server.app - INFO - [PM-CHAT-TIMING] process_with_streaming started: 4.60s
2025-11-03 12:38:46,589 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-03 12:38:46,592 - src.conversation.flow_manager - WARNING - Could not find JSON in LLM response: null
2025-11-03 12:38:46,592 - src.conversation.flow_manager - INFO - Extracted initial data: {}
2025-11-03 12:38:46,592 - src.conversation.flow_manager - INFO - [TIMING] generate_pm_plan started
2025-11-03 12:38:51,182 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-03 12:38:51,188 - src.conversation.flow_manager - INFO - [TIMING] LLM invoke completed: 4.60s
2025-11-03 12:38:51,189 - src.conversation.flow_manager - INFO - PM plan LLM response: {
  "locale": "vi-VN",
  "overall_thought": "Người dùng muốn xoá tất cả ETA cho các task được giao. Tôi sẽ liệt kê tất cả task của người dùng và sau đó cập nhật để xoá ETA.",
  "steps": [
    {
      "step_type": "list_my_tasks",
      "title": "Liệt kê Tasks Được Assign",
      "description": "Liệt kê tất cả task được giao cho user để xác định các task có ETA.",
      "requires_context": false
    },
    {
      "step_type": "update_task",
      "title": "Xoá ETA cho Tất cả Tasks",
      "description": "Cập nhật tất cả task được liệt kê để xoá giá trị ETA.",
      "requires_context": true
    }
  ]
}
2025-11-03 12:38:51,189 - src.conversation.flow_manager - INFO - Generated PM plan with 2 steps in 4.60s
2025-11-03 12:38:51,189 - src.conversation.flow_manager - INFO - Generated PM plan with 2 steps
2025-11-03 12:38:51,189 - src.conversation.flow_manager - INFO - Final current_state: FlowState.PLANNING_PHASE, intent: IntentType.UNKNOWN
2025-11-03 12:38:51,189 - src.conversation.flow_manager - INFO - [TIMING] _handle_planning_phase started
2025-11-03 12:38:51,189 - src.conversation.flow_manager - INFO - [TIMING] Plan has 2 steps - 0.00s
2025-11-03 12:38:51,189 - src.conversation.flow_manager - INFO - [TIMING] Executing step 1/2: Liệt kê Tasks Được Assign - 0.00s
2025-11-03 12:38:51,189 - src.conversation.flow_manager - INFO - Executing PM step: list_my_tasks
2025-11-03 12:38:52,027 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-03 12:38:52,031 - src.conversation.flow_manager - INFO - Extracted data: {'filter_week': None, 'filter_date': None, 'period': None}
2025-11-03 12:38:52,032 - src.conversation.flow_manager - INFO - Extracted list_my_tasks data: {'filter_week': None, 'filter_date': None, 'period': None}
2025-11-03 12:38:52,032 - src.conversation.flow_manager - INFO - Handling LIST_MY_TASKS intent
2025-11-03 12:38:52,050 - src.conversation.flow_manager - INFO - Using current user from API key: OpenProject Admin (ID: 4)
2025-11-03 12:38:52,050 - src.pm_providers.openproject - INFO - OpenProject list_tasks with filters: {'filters': '[{"assignee": {"operator": "=", "values": ["4"]}}]'}
2025-11-03 12:38:52,157 - src.conversation.flow_manager - INFO - Calculated total hours: 188.0 from 20 tasks
2025-11-03 12:38:52,183 - src.conversation.flow_manager - INFO - [TIMING] Step 1 completed in 0.99s - 0.99s total
2025-11-03 12:38:52,184 - src.conversation.flow_manager - INFO - [TIMING] Executing step 2/2: Xoá ETA cho Tất cả Tasks - 0.99s
2025-11-03 12:38:52,184 - src.conversation.flow_manager - INFO - Executing PM step: update_task
2025-11-03 12:38:54,492 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-03 12:38:54,501 - src.conversation.flow_manager - INFO - Extracted data: {'task_id': None, 'task_title': None, 'new_title': None, 'new_status': None, 'new_priority': None, 'new_estimated_hours': 0, 'new_description': None}
2025-11-03 12:38:54,502 - src.conversation.flow_manager - INFO - Extracted update_task data: {'task_id': None, 'task_title': None, 'new_title': None, 'new_status': None, 'new_priority': None, 'new_estimated_hours': 0, 'new_description': None}
2025-11-03 12:38:54,502 - src.conversation.flow_manager - INFO - Handling UPDATE_TASK intent
2025-11-03 12:38:54,502 - src.conversation.flow_manager - INFO - Handling bulk ETA deletion
2025-11-03 12:38:54,531 - src.pm_providers.openproject - INFO - OpenProject list_tasks with filters: {'filters': '[{"assignee": {"operator": "=", "values": ["4"]}}]'}
2025-11-03 12:38:57,746 - src.conversation.flow_manager - INFO - [TIMING] Step 2 completed in 5.56s - 6.56s total
2025-11-03 12:38:57,747 - src.server.app - INFO - [PM-CHAT-TIMING] process_message completed: 11.77s
2025-11-03 12:38:57,748 - src.server.app - INFO - [PM-CHAT-TIMING] Total response time: 16.37s
INFO:     ::1:52708 - "POST /api/pm/chat/stream HTTP/1.1" 200 OK
2025-11-03 12:39:14,244 - src.server.app - INFO - [PM-CHAT-TIMING] generate_stream started
2025-11-03 12:39:14,244 - src.conversation.flow_manager - INFO - [TIMING] generate_pm_plan started
2025-11-03 12:39:16,920 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-03 12:39:16,923 - src.conversation.flow_manager - INFO - [TIMING] LLM invoke completed: 2.68s
2025-11-03 12:39:16,924 - src.conversation.flow_manager - INFO - PM plan LLM response: {
  "locale": "vi-VN",
  "overall_thought": "Người dùng muốn tính ETA cho các task của họ. Tôi sẽ liệt kê tất cả các task được giao cho user trước.",
  "steps": [
    {
      "step_type": "list_my_tasks",
      "title": "Liệt kê Tasks Được Giao",
      "description": "Liệt kê tất cả task được giao cho user để kiểm tra các task cần tính ETA",
      "requires_context": false
    }
  ]
}
2025-11-03 12:39:16,924 - src.conversation.flow_manager - INFO - Generated PM plan with 1 steps in 2.68s
2025-11-03 12:39:16,924 - src.server.app - INFO - [PM-CHAT-TIMING] PM plan generated: 2.68s
2025-11-03 12:39:16,924 - src.server.app - INFO - [PM-CHAT-TIMING] Needs research: False - 2.68s
2025-11-03 12:39:16,924 - src.server.app - INFO - [PM-CHAT-TIMING] process_task started: 2.68s
2025-11-03 12:39:16,924 - src.server.app - INFO - [PM-CHAT-TIMING] process_with_streaming started: 2.68s
2025-11-03 12:39:17,710 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-03 12:39:17,713 - src.conversation.flow_manager - WARNING - Could not find JSON in LLM response: ```json
null
```
2025-11-03 12:39:17,713 - src.conversation.flow_manager - INFO - Extracted initial data: {}
2025-11-03 12:39:17,713 - src.conversation.flow_manager - INFO - [TIMING] generate_pm_plan started
2025-11-03 12:39:22,934 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-03 12:39:22,937 - src.conversation.flow_manager - INFO - [TIMING] LLM invoke completed: 5.22s
2025-11-03 12:39:22,937 - src.conversation.flow_manager - INFO - PM plan LLM response: {
  "locale": "vi-VN",
  "overall_thought": "Người dùng muốn tính ETA cho các task. Tôi sẽ liệt kê các task được giao cho họ trước, sau đó nghiên cứu để ước tính thời gian cho từng task.",
  "steps": [
    {
      "step_type": "list_my_tasks",
      "title": "Liệt kê Tasks Được Assign",
      "description": "Liệt kê tất cả task được giao cho user để xem task nào chưa có ETA",
      "requires_context": false
    },
    {
      "step_type": "research",
      "title": "Nghiên cứu ước tính thời gian cho từng task",
      "description": "Nghiên cứu và đưa ra ước tính thời gian hợp lý cho từng task dựa trên độ phức tạp và yêu cầu",
      "requires_context": true
    }
  ]
}
2025-11-03 12:39:22,937 - src.conversation.flow_manager - INFO - Generated PM plan with 2 steps in 5.22s
2025-11-03 12:39:22,937 - src.conversation.flow_manager - INFO - Generated PM plan with 2 steps
2025-11-03 12:39:22,937 - src.conversation.flow_manager - INFO - Final current_state: FlowState.PLANNING_PHASE, intent: IntentType.UNKNOWN
2025-11-03 12:39:22,937 - src.conversation.flow_manager - INFO - [TIMING] _handle_planning_phase started
2025-11-03 12:39:22,937 - src.conversation.flow_manager - INFO - [TIMING] Plan has 2 steps - 0.00s
2025-11-03 12:39:22,937 - src.conversation.flow_manager - INFO - [TIMING] Executing step 1/2: Liệt kê Tasks Được Assign - 0.00s
2025-11-03 12:39:22,937 - src.conversation.flow_manager - INFO - Executing PM step: list_my_tasks
2025-11-03 12:39:24,146 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-03 12:39:24,148 - src.conversation.flow_manager - INFO - Extracted data: {'filter_week': None, 'filter_date': None, 'period': None}
2025-11-03 12:39:24,148 - src.conversation.flow_manager - INFO - Extracted list_my_tasks data: {'filter_week': None, 'filter_date': None, 'period': None}
2025-11-03 12:39:24,148 - src.conversation.flow_manager - INFO - Handling LIST_MY_TASKS intent
2025-11-03 12:39:24,180 - src.conversation.flow_manager - INFO - Using current user from API key: OpenProject Admin (ID: 4)
2025-11-03 12:39:24,180 - src.pm_providers.openproject - INFO - OpenProject list_tasks with filters: {'filters': '[{"assignee": {"operator": "=", "values": ["4"]}}]'}
2025-11-03 12:39:24,314 - src.conversation.flow_manager - INFO - Calculated total hours: 0.0 from 20 tasks
2025-11-03 12:39:24,339 - src.conversation.flow_manager - INFO - [TIMING] Step 1 completed in 1.40s - 1.40s total
2025-11-03 12:39:24,339 - src.conversation.flow_manager - INFO - [TIMING] Executing step 2/2: Nghiên cứu ước tính thời gian cho từng task - 1.40s
2025-11-03 12:39:24,340 - src.conversation.flow_manager - INFO - Executing PM step: research
2025-11-03 12:39:24,340 - src.conversation.flow_manager - INFO - Handling ETA research
2025-11-03 12:39:24,351 - src.pm_providers.openproject - INFO - OpenProject list_tasks with filters: {'filters': '[{"assignee": {"operator": "=", "values": ["4"]}}]'}
2025-11-03 12:39:28,464 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-03 12:39:28,467 - src.conversation.flow_manager - INFO - LLM ETA response: - Start of project (ID: 1): 4 hours  
- Organize open source conference (ID: 2): 40 hours  
- Set date and location of conference (ID: 3): 8 hours  
- Send invitation to speakers (ID: 4): 2 hours  
- Contact sponsoring partners (ID: 5): 6 hours  
- Create sponsorship brochure and hand-outs (ID: 6): 12 hours  
- Invite attendees to conference (ID: 7): 4 hours  
- Setup conference website (ID: 8): 10 hours  
- Conference (ID: 9): 24 hours  
- Follow-up tasks (ID: 10): 5 hours  
2025-11-03 12:39:28,467 - src.conversation.flow_manager - INFO - Parsed ETA for Start of project: 4.0h
2025-11-03 12:39:28,468 - src.conversation.flow_manager - INFO - Parsed ETA for Organize open source conference: 40.0h
2025-11-03 12:39:28,468 - src.conversation.flow_manager - INFO - Parsed ETA for Set date and location of conference: 8.0h
2025-11-03 12:39:28,468 - src.conversation.flow_manager - INFO - Parsed ETA for Send invitation to speakers: 2.0h
2025-11-03 12:39:28,468 - src.conversation.flow_manager - INFO - Parsed ETA for Contact sponsoring partners: 6.0h
2025-11-03 12:39:28,469 - src.conversation.flow_manager - INFO - Parsed ETA for Create sponsorship brochure and hand-outs: 12.0h
2025-11-03 12:39:28,469 - src.conversation.flow_manager - INFO - Parsed ETA for Invite attendees to conference: 4.0h
2025-11-03 12:39:28,469 - src.conversation.flow_manager - INFO - Parsed ETA for Setup conference website: 10.0h
2025-11-03 12:39:28,469 - src.conversation.flow_manager - INFO - Parsed ETA for Conference: 24.0h
2025-11-03 12:39:28,469 - src.conversation.flow_manager - INFO - Parsed ETA for Follow-up tasks: 5.0h
2025-11-03 12:39:30,358 - src.conversation.flow_manager - INFO - [TIMING] Step 2 completed in 6.02s - 7.42s total
2025-11-03 12:39:30,358 - src.server.app - INFO - [PM-CHAT-TIMING] process_message completed: 13.43s
2025-11-03 12:39:30,360 - src.server.app - INFO - [PM-CHAT-TIMING] Total response time: 16.12s
