2025-11-03 11:46:28,635 - __main__ - INFO - Starting DeerFlow API server on localhost:8000
2025-11-03 11:46:28,635 - __main__ - INFO - Log level: INFO
2025-11-03 11:46:30,146 - src.graph.checkpoint - WARNING - Checkpoint saver is disabled
2025-11-03 11:46:30,172 - src.server.app - INFO - Allowed origins: ['http://localhost:3000']
INFO:     Started server process [19760]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://localhost:8000 (Press CTRL+C to quit)
2025-11-03 11:46:43,464 - src.conversation.flow_manager - INFO - LLM-based intent classifier initialized
2025-11-03 11:46:43,464 - src.conversation.flow_manager - INFO - LLM-based data extractor initialized
2025-11-03 11:46:43,469 - src.conversation.flow_manager - INFO - PM Provider initialized: OpenProjectProvider
2025-11-03 11:46:43,533 - src.conversation.flow_manager - INFO - Self-learning system initialized
2025-11-03 11:46:43,533 - src.server.app - INFO - Created global ConversationFlowManager singleton
INFO:     ::1:65135 - "POST /api/pm/chat/stream HTTP/1.1" 200 OK
2025-11-03 11:46:43,537 - src.server.app - INFO - [PM-CHAT-TIMING] generate_stream started
2025-11-03 11:46:43,537 - src.conversation.flow_manager - INFO - [TIMING] generate_pm_plan started
2025-11-03 11:46:46,998 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-03 11:46:47,015 - src.conversation.flow_manager - INFO - [TIMING] LLM invoke completed: 3.47s
2025-11-03 11:46:47,015 - src.conversation.flow_manager - INFO - PM plan LLM response: {
  "locale": "vi-VN",
  "overall_thought": "Người dùng muốn tính ETA cho các task chưa có ETA. Tôi sẽ liệt kê tasks, nghiên cứu để ước tính thời gian, sau đó cập nhật ETA cho từng task.",
  "steps": [
    {
      "step_type": "list_my_tasks",
      "title": "Liệt kê Tasks Được Assign",
      "description": "Liệt kê tất cả task được giao cho user để xem task nào chưa có ETA",
      "requires_context": false
    },
    {
      "step_type": "research",
      "title": "Nghiên cứu ước tính thời gian cho từng task",
      "description": "Nghiên cứu và đưa ra ước tính thời gian hợp lý cho từng task dựa trên độ phức tạp và yêu cầu",
      "requires_context": true
    }
  ]
}
2025-11-03 11:46:47,015 - src.conversation.flow_manager - INFO - Generated PM plan with 2 steps in 3.48s
2025-11-03 11:46:47,015 - src.server.app - INFO - [PM-CHAT-TIMING] PM plan generated: 3.48s
2025-11-03 11:46:47,016 - src.server.app - INFO - [PM-CHAT-TIMING] Needs research: False - 3.48s
2025-11-03 11:46:47,016 - src.server.app - INFO - [PM-CHAT-TIMING] process_task started: 3.48s
2025-11-03 11:46:47,016 - src.server.app - INFO - [PM-CHAT-TIMING] process_with_streaming started: 3.48s
2025-11-03 11:46:47,560 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-03 11:46:47,566 - src.conversation.flow_manager - WARNING - Could not find JSON in LLM response: null
2025-11-03 11:46:47,566 - src.conversation.flow_manager - INFO - Extracted initial data: {}
2025-11-03 11:46:47,566 - src.conversation.flow_manager - INFO - [TIMING] generate_pm_plan started
2025-11-03 11:46:51,044 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-03 11:46:51,046 - src.conversation.flow_manager - INFO - [TIMING] LLM invoke completed: 3.48s
2025-11-03 11:46:51,046 - src.conversation.flow_manager - INFO - PM plan LLM response: {
  "locale": "vi-VN",
  "overall_thought": "Người dùng muốn tính ETA cho các task chưa có ETA. Tôi sẽ liệt kê tasks, nghiên cứu để ước tính thời gian, sau đó cập nhật ETA cho từng task.",
  "steps": [
    {
      "step_type": "list_my_tasks",
      "title": "Liệt kê Tasks Được Assign",
      "description": "Liệt kê tất cả task được giao cho user để xem task nào chưa có ETA",
      "requires_context": false
    },
    {
      "step_type": "research",
      "title": "Nghiên cứu ước tính thời gian cho từng task",
      "description": "Nghiên cứu và đưa ra ước tính thời gian hợp lý cho từng task dựa trên độ phức tạp và yêu cầu",
      "requires_context": true
    }
  ]
}
2025-11-03 11:46:51,046 - src.conversation.flow_manager - INFO - Generated PM plan with 2 steps in 3.48s
2025-11-03 11:46:51,046 - src.conversation.flow_manager - INFO - Generated PM plan with 2 steps
2025-11-03 11:46:51,046 - src.conversation.flow_manager - INFO - Final current_state: FlowState.PLANNING_PHASE, intent: IntentType.UNKNOWN
2025-11-03 11:46:51,046 - src.conversation.flow_manager - INFO - [TIMING] _handle_planning_phase started
2025-11-03 11:46:51,046 - src.conversation.flow_manager - INFO - [TIMING] Plan has 2 steps - 0.00s
2025-11-03 11:46:51,046 - src.conversation.flow_manager - INFO - [TIMING] Executing step 1/2: Liệt kê Tasks Được Assign - 0.00s
2025-11-03 11:46:51,046 - src.conversation.flow_manager - INFO - Executing PM step: list_my_tasks
2025-11-03 11:46:52,071 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-03 11:46:52,073 - src.conversation.flow_manager - INFO - Extracted data: {'filter_week': None, 'filter_date': None, 'period': None}
2025-11-03 11:46:52,073 - src.conversation.flow_manager - INFO - Extracted list_my_tasks data: {'filter_week': None, 'filter_date': None, 'period': None}
2025-11-03 11:46:52,073 - src.conversation.flow_manager - INFO - Handling LIST_MY_TASKS intent
2025-11-03 11:46:52,119 - src.conversation.flow_manager - INFO - Using current user from API key: OpenProject Admin (ID: 4)
2025-11-03 11:46:52,119 - src.pm_providers.openproject - INFO - OpenProject list_tasks with filters: {'filters': '[{"assignee": {"operator": "=", "values": ["4"]}}]'}
2025-11-03 11:46:52,260 - src.conversation.flow_manager - INFO - Calculated total hours: 8.0 from 20 tasks
2025-11-03 11:46:52,289 - src.conversation.flow_manager - INFO - [TIMING] Step 1 completed in 1.24s - 1.24s total
2025-11-03 11:46:52,289 - src.conversation.flow_manager - INFO - [TIMING] Executing step 2/2: Nghiên cứu ước tính thời gian cho từng task - 1.24s
2025-11-03 11:46:52,289 - src.conversation.flow_manager - INFO - Executing PM step: research
2025-11-03 11:46:52,290 - src.conversation.flow_manager - INFO - Handling ETA research
2025-11-03 11:46:52,318 - src.pm_providers.openproject - INFO - OpenProject list_tasks with filters: {'filters': '[{"assignee": {"operator": "=", "values": ["4"]}}]'}
2025-11-03 11:46:55,553 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-03 11:46:55,555 - src.conversation.flow_manager - INFO - LLM ETA response: - Start of project (ID: 1): 8 hours
- Organize open source conference (ID: 2): 80 hours
- Contact sponsoring partners (ID: 5): 20 hours
- Create sponsorship brochure and hand-outs (ID: 6): 15 hours
- Invite attendees to conference (ID: 7): 12 hours
- Setup conference website (ID: 8): 25 hours
- Conference (ID: 9): 40 hours
- Follow-up tasks (ID: 10): 10 hours
- Upload presentations to website (ID: 11): 5 hours
- Party for conference supporters :-) (ID: 12): 10 hours
2025-11-03 11:46:55,556 - src.conversation.flow_manager - INFO - Parsed ETA for Start of project: 8.0h
2025-11-03 11:46:55,556 - src.conversation.flow_manager - INFO - Parsed ETA for Organize open source conference: 80.0h
2025-11-03 11:46:55,557 - src.conversation.flow_manager - INFO - Parsed ETA for Contact sponsoring partners: 20.0h
2025-11-03 11:46:55,557 - src.conversation.flow_manager - INFO - Parsed ETA for Create sponsorship brochure and hand-outs: 15.0h
2025-11-03 11:46:55,557 - src.conversation.flow_manager - INFO - Parsed ETA for Invite attendees to conference: 12.0h
2025-11-03 11:46:55,557 - src.conversation.flow_manager - INFO - Parsed ETA for Setup conference website: 25.0h
2025-11-03 11:46:55,557 - src.conversation.flow_manager - INFO - Parsed ETA for Conference: 40.0h
2025-11-03 11:46:55,558 - src.conversation.flow_manager - INFO - Parsed ETA for Follow-up tasks: 10.0h
2025-11-03 11:46:55,558 - src.conversation.flow_manager - INFO - Parsed ETA for Upload presentations to website: 5.0h
2025-11-03 11:46:55,558 - src.conversation.flow_manager - INFO - Parsed ETA for Party for conference supporters :-): 10.0h
2025-11-03 11:46:57,329 - src.conversation.flow_manager - INFO - [TIMING] Step 2 completed in 5.04s - 6.28s total
2025-11-03 11:46:57,330 - src.server.app - INFO - [PM-CHAT-TIMING] process_message completed: 10.31s
2025-11-03 11:46:57,332 - src.server.app - INFO - [PM-CHAT-TIMING] Total response time: 13.79s
INFO:     ::1:65245 - "POST /api/pm/chat/stream HTTP/1.1" 200 OK
2025-11-03 11:47:17,606 - src.server.app - INFO - [PM-CHAT-TIMING] generate_stream started
2025-11-03 11:47:17,606 - src.conversation.flow_manager - INFO - [TIMING] generate_pm_plan started
2025-11-03 11:47:21,789 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-03 11:47:21,798 - src.conversation.flow_manager - INFO - [TIMING] LLM invoke completed: 4.19s
2025-11-03 11:47:21,798 - src.conversation.flow_manager - INFO - PM plan LLM response: {
  "locale": "vi-VN",
  "overall_thought": "Người dùng muốn tính ETA cho các task chưa có ETA. Tôi sẽ liệt kê tasks, nghiên cứu để ước tính thời gian, sau đó cập nhật ETA cho từng task.",
  "steps": [
    {
      "step_type": "list_my_tasks",
      "title": "Liệt kê Tasks Được Assign",
      "description": "Liệt kê tất cả task được giao cho user để xem task nào chưa có ETA",
      "requires_context": false
    },
    {
      "step_type": "research",
      "title": "Nghiên cứu ước tính thời gian cho từng task",
      "description": "Nghiên cứu và đưa ra ước tính thời gian hợp lý cho từng task dựa trên độ phức tạp và yêu cầu",
      "requires_context": true
    }
  ]
}
2025-11-03 11:47:21,798 - src.conversation.flow_manager - INFO - Generated PM plan with 2 steps in 4.19s
2025-11-03 11:47:21,798 - src.server.app - INFO - [PM-CHAT-TIMING] PM plan generated: 4.19s
2025-11-03 11:47:21,798 - src.server.app - INFO - [PM-CHAT-TIMING] Needs research: False - 4.19s
2025-11-03 11:47:21,798 - src.server.app - INFO - [PM-CHAT-TIMING] process_task started: 4.19s
2025-11-03 11:47:21,798 - src.server.app - INFO - [PM-CHAT-TIMING] process_with_streaming started: 4.19s
2025-11-03 11:47:22,593 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-03 11:47:22,607 - src.conversation.flow_manager - WARNING - Could not find JSON in LLM response: ```json
null
```
2025-11-03 11:47:22,607 - src.conversation.flow_manager - INFO - Extracted initial data: {}
2025-11-03 11:47:22,607 - src.conversation.flow_manager - INFO - [TIMING] generate_pm_plan started
2025-11-03 11:47:26,511 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-03 11:47:26,513 - src.conversation.flow_manager - INFO - [TIMING] LLM invoke completed: 3.91s
2025-11-03 11:47:26,513 - src.conversation.flow_manager - INFO - PM plan LLM response: {
  "locale": "vi-VN",
  "overall_thought": "Người dùng muốn tính ETA cho các task chưa có ETA. Tôi sẽ liệt kê tasks, nghiên cứu để ước tính thời gian, sau đó cập nhật ETA cho từng task.",
  "steps": [
    {
      "step_type": "list_my_tasks",
      "title": "Liệt kê Tasks Được Assign",
      "description": "Liệt kê tất cả task được giao cho user để xem task nào chưa có ETA",
      "requires_context": false
    },
    {
      "step_type": "research",
      "title": "Nghiên cứu ước tính thời gian cho từng task",
      "description": "Nghiên cứu và đưa ra ước tính thời gian hợp lý cho từng task dựa trên độ phức tạp và yêu cầu",
      "requires_context": true
    }
  ]
}
2025-11-03 11:47:26,513 - src.conversation.flow_manager - INFO - Generated PM plan with 2 steps in 3.91s
2025-11-03 11:47:26,513 - src.conversation.flow_manager - INFO - Generated PM plan with 2 steps
2025-11-03 11:47:26,513 - src.conversation.flow_manager - INFO - Final current_state: FlowState.PLANNING_PHASE, intent: IntentType.UNKNOWN
2025-11-03 11:47:26,513 - src.conversation.flow_manager - INFO - [TIMING] _handle_planning_phase started
2025-11-03 11:47:26,513 - src.conversation.flow_manager - INFO - [TIMING] Plan has 2 steps - 0.00s
2025-11-03 11:47:26,513 - src.conversation.flow_manager - INFO - [TIMING] Executing step 1/2: Liệt kê Tasks Được Assign - 0.00s
2025-11-03 11:47:26,513 - src.conversation.flow_manager - INFO - Executing PM step: list_my_tasks
2025-11-03 11:47:27,478 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-03 11:47:27,481 - src.conversation.flow_manager - INFO - Extracted data: {'filter_week': None, 'filter_date': None, 'period': None}
2025-11-03 11:47:27,481 - src.conversation.flow_manager - INFO - Extracted list_my_tasks data: {'filter_week': None, 'filter_date': None, 'period': None}
2025-11-03 11:47:27,481 - src.conversation.flow_manager - INFO - Handling LIST_MY_TASKS intent
2025-11-03 11:47:27,510 - src.conversation.flow_manager - INFO - Using current user from API key: OpenProject Admin (ID: 4)
2025-11-03 11:47:27,510 - src.pm_providers.openproject - INFO - OpenProject list_tasks with filters: {'filters': '[{"assignee": {"operator": "=", "values": ["4"]}}]'}
2025-11-03 11:47:27,649 - src.conversation.flow_manager - INFO - Calculated total hours: 113.0 from 20 tasks
2025-11-03 11:47:27,675 - src.conversation.flow_manager - INFO - [TIMING] Step 1 completed in 1.16s - 1.16s total
2025-11-03 11:47:27,676 - src.conversation.flow_manager - INFO - [TIMING] Executing step 2/2: Nghiên cứu ước tính thời gian cho từng task - 1.16s
2025-11-03 11:47:27,676 - src.conversation.flow_manager - INFO - Executing PM step: research
2025-11-03 11:47:27,676 - src.conversation.flow_manager - INFO - Handling ETA research
2025-11-03 11:47:27,684 - src.pm_providers.openproject - INFO - OpenProject list_tasks with filters: {'filters': '[{"assignee": {"operator": "=", "values": ["4"]}}]'}
2025-11-03 11:47:30,333 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-11-03 11:47:30,376 - src.conversation.flow_manager - INFO - LLM ETA response: - End of project (ID: 13): 10 hours
- New login screen (ID: 14): 20 hours
- Password reset does not send email (ID: 15): 5 hours
- New website (ID: 16): 80 hours
- Newsletter registration form (ID: 17): 15 hours
- Implement product tour (ID: 18): 25 hours
- New landing page (ID: 19): 30 hours
- Create wireframes for new landing page (ID: 20): 15 hours
2025-11-03 11:47:30,377 - src.conversation.flow_manager - INFO - Parsed ETA for End of project: 10.0h
2025-11-03 11:47:30,377 - src.conversation.flow_manager - INFO - Parsed ETA for New login screen: 20.0h
2025-11-03 11:47:30,377 - src.conversation.flow_manager - INFO - Parsed ETA for Password reset does not send email: 5.0h
2025-11-03 11:47:30,377 - src.conversation.flow_manager - INFO - Parsed ETA for New website: 80.0h
2025-11-03 11:47:30,377 - src.conversation.flow_manager - INFO - Parsed ETA for Newsletter registration form: 15.0h
2025-11-03 11:47:30,377 - src.conversation.flow_manager - INFO - Parsed ETA for Implement product tour: 25.0h
2025-11-03 11:47:30,377 - src.conversation.flow_manager - INFO - Parsed ETA for New landing page: 30.0h
2025-11-03 11:47:30,377 - src.conversation.flow_manager - INFO - Parsed ETA for Create wireframes for new landing page: 15.0h
2025-11-03 11:47:31,806 - src.conversation.flow_manager - INFO - [TIMING] Step 2 completed in 4.13s - 5.29s total
2025-11-03 11:47:31,806 - src.server.app - INFO - [PM-CHAT-TIMING] process_message completed: 10.01s
2025-11-03 11:47:31,806 - src.server.app - INFO - [PM-CHAT-TIMING] Total response time: 14.20s
