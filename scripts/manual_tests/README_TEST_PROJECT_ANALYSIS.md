# Project Analysis Report Test Script

This script validates comprehensive project analysis reports generated by the backend API to ensure they meet all requirements.

## Prerequisites

1. Backend service must be running on `http://localhost:8000`
2. PM Service must be running and configured
3. At least one project must be available in the system

## Installation

Install required dependencies:

```bash
pip install httpx
```

## Usage

### Basic Usage

Run the script with default test query:

```bash
python scripts/test_project_analysis.py
```

### Custom Query

Run with a custom query:

```bash
python scripts/test_project_analysis.py "Generate comprehensive project analysis for project e6890ea6-0c3c-4a83-aa05-41b223df3284:478"
```

## What It Tests

The script validates:

1. **Section Titles**: Checks that all 10 required sections use the correct titles (A-J format, not numbered)
2. **Word Counts**: Verifies each section meets its minimum word count requirement:
   - Section A (Executive Summary): 200-300 words
   - Section B (Sprint Overview): 100-200 words
   - Section C (Burndown): 300-400 words
   - Section D (Velocity): 300-400 words
   - Section E (CFD): 200-300 words
   - Section F (Cycle Time): 200-300 words
   - Section G (Work Distribution): 300-400 words
   - Section H (Issue Trend): 200-300 words
   - Section I (Task Statistics): 150-250 words
   - Section J (Key Insights): 400-500 words

3. **Required Components**: Checks that each section includes all required components:
   - Section A: health status, key achievements, concerns, recommended actions
   - Section B: all sprints, start/end dates, status, committed/completed points
   - Section C: current progress, pattern analysis, scope changes, forecast, recommendations
   - Section D: current velocity, average velocity, completion rates by sprint, commitment vs delivery, capacity planning
   - Section E: WIP analysis, bottleneck detection, flow efficiency, recommendations
   - Section F: average cycle time, 50th/85th/95th percentiles, outlier analysis
   - Section G: By Assignee, By Status, By Priority, By Type tables
   - Section H: created vs resolved, net change, daily rates, trend interpretation, forecast
   - Section I: total tasks summary, By Status table, By Sprint table, By Assignee table
   - Section J: Strengths, Concerns, Risks, Action Items, Next Steps

4. **Wrong Titles**: Checks that the report doesn't use wrong section titles like:
   - "1. Project Overview" (should be "A. Executive Summary")
   - "Closing Notes" (should be "J. ðŸŽ¯ Key Insights & Recommendations")
   - "Task Breakdown" (should be "I. Task Statistics Summary")

## Output

The script:
1. Calls the backend API and collects the full report
2. Saves the report to `test_report_output.md`
3. Validates all requirements
4. Prints a detailed validation summary

### Exit Codes

- `0`: Report is valid (all requirements met)
- `1`: Report is invalid (missing sections, wrong titles, or insufficient word counts)

## Example Output

```
================================================================================
PROJECT ANALYSIS REPORT TEST
================================================================================

Calling API: http://localhost:8000/api/chat/stream
Query: Generate comprehensive project analysis for project e6890ea6-0c3c-4a83-aa05-41b223df3284:478
Waiting for response...

Report saved to test_report_output.md

================================================================================
VALIDATING REPORT
================================================================================

Checking A. Executive Summary...
  âœ… Title: A. Executive Summary
  âœ… Word count: 245 (range: 200-300)
  âœ… All required components present

Checking B. Sprint Overview Table...
  âœ… Title: B. Sprint Overview Table
  âœ… Word count: 150 (range: 100-200)
  âœ… All required components present

...

================================================================================
VALIDATION SUMMARY
================================================================================

âœ… REPORT IS VALID

SECTION DETAILS:
  âœ… A. Executive Summary: 245 words
  âœ… B. Sprint Overview Table: 150 words
  ...
```

## Troubleshooting

### API Connection Error

If you get connection errors, ensure:
- Backend service is running: `docker-compose up backend`
- Backend is accessible at `http://localhost:8000`
- Check backend logs for errors

### Missing Sections

If sections are missing:
- Check backend logs for errors during report generation
- Verify the project ID exists and has data
- Check that all analytics tools are working correctly

### Wrong Section Titles

If wrong section titles are found:
- The prompt may not be loaded correctly - restart the backend service
- Check `src/prompts/reporter.md` for the latest requirements

## Configuration

Edit the script to change:
- `BACKEND_URL`: Backend API URL (default: `http://localhost:8000`)
- `TEST_PROJECT_ID`: Default project ID to test
- `TEST_QUERY`: Default query to use

## Integration with CI/CD

This script can be integrated into CI/CD pipelines to automatically validate reports:

```yaml
# Example GitHub Actions workflow
- name: Test Project Analysis
  run: |
    python scripts/test_project_analysis.py
```

